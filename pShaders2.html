<!DOCTYPE HTML>
<!--
	David Styven Nieto Marin
	Ingenieria de Sistemas | @dsnietom
	Universidad Nacional de Colombia
-->
<html>
	<head>
		<title>Procesamiento de Imagenes | :: Computación Visual ::</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		
		<!-- Code-Prettify -->
		<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
		
		<!-- P5.js -->
		<script src="p5/p5.min.js"></script>
		<script src="p5/addons/p5.sound.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/addons/p5.sound.min.js"></script> -->
		
		<!-- Bootstrap CSS 
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">-->
	
		<!-- Favicon -->
		<link rel="icon" href="images/favicon.png" sizes="32x32" type="image/png">

		
	</head>
	
	<body class="single is-preload">
	
	

		<!-- Wrapper -->
			<div id="wrapper">
			

				<!-- Header -->
					<header id="header">
						
						<nav class="links">
						
						<!-- Se crea un encabezado para insertar el html donde esta el menu-->
							<iframe src="menu.html" ></iframe>
							
						</nav>
						<nav class="main">
							<ul>
								<li class="search">
									<a class="fa-search" href="#search">Search</a>
									<form id="search" method="get" action="#">
										<input type="text" name="query" placeholder="Search" />
									</form>
								</li>
								<li class="menu">
									<a class="fa-bars" href="#menu">Menu</a>
								</li>
							</ul>
						</nav>
					</header>

				<!-- Menu -->
				<section id="menu">

					<!-- Search -->
						<section>
						<h1><a href="index.html" target="_parent">Visual Computing</a></h1>
							<form class="search" method="get" action="#">
								<input type="text" name="query" placeholder="Search" />
							</form>
						</section>

					<!-- Links -->
						<section>
							<ul class="links">
								<li>
									<a href="pShaders1.html" target="_parent">
										<h3>GRAYSCALE IMAGE AND VIDEO</h3>
										<p>SHADERS AND WEBGL</p>
									</a>
								</li>
								<li>
									<a href="pShaders2.html" target="_parent">
										<h3>CONVOLUTION MATRIX</h3>
										<p>SHADERS AND WEBGL</p>
									</a>
								</li>						
									
							</ul>
						</section>

					<!-- Actions -->
						<section>
							<ul class="actions stacked">
								<li><a href="https://github.com/VisualComp/Procesamiento-imagenes/tree/master/Hardware" target="_blank" class="button large fit">Repository</a></li>
							</ul>
						</section>

				</section>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2><a href="https://en.wikipedia.org/wiki/HSL_and_HSV" target="_blank">Convolution Matrix</a></h2>
										<p>Shaders and WEBGL</p>
									</div>
									<div class="meta">
										<time class="published" datetime="2020-04-16">June 04, 2020</time>
										<a href="https://dsnietom.github.io/myPageIngSoft/" target="_blank" class="author"><span class="name">David Nieto</span><img src="images/avatar.jpg" alt="dsnietom" /></a>
										
									</div>
								</header>
								<p>En la siguiente publicación se pondrá en practica lo aprendido durante el estudio de procesamiento de imágenes en los ejemplos expuestos y desarrollados en <a href="images1.html" target="_parent">PIXELS AND IMAGES</a>, donde se observó cómo funciona una matriz de pixeles y cómo modificar los pixeles de una imagen accediendo a los valores de este arreglo.</p>
								
								<p>A continuación, se observará cómo se puede obtener una imagen a escala de grises a partir del <em>Promedio</em> de los componentes RGB de una imagen y el caculo del coeficiente <em>Luma</em>. Para ello este estudio esta basado en la documentación <a href="https://en.wikipedia.org/wiki/HSL_and_HSV#Lightness" target="_blank">HSL and HSV</a> y en gran medida estará basado en el ejemplo <a href="images4.html" target="_parent">BLACK AND WHITE</a> anteriormente trabajado, por lo tanto, no se profundizará en los cálculos de las expresiones, sino en la manera de aplicar estas expresiones a nuestro programa en p5.js para modificar la luminancia de la imagen y obtener los resultados esperados.</p>
								
								<p>Para obtener una imagen a escala de grises por medio del siguiente programa, bastará con acceder al componente RGB de cada pixel de la imagen, hacer el cálculo del <strong>Promedio RGB</strong> o el coeficiente <strong>Luma</strong> utilizando las expresiones descritas en la tabla de Comandos por Teclado y por último se reemplazará el valor obtenido en cada uno de los componentes de color RGB del pixel. Adicionalmente también se observarán otras posibilidades para modificar la luminancia de la imagen y obtener la imagen a escala de grises a partir del calculo del <strong>Componente mas grande</strong>, el <strong>Rango medio</strong> y el <strong>Valor de Munsell</strong> visto en la documentación <a href="https://en.wikipedia.org/wiki/Lightness#Relationship_to_value_and_relative_luminance" target="_blank">Lightness</a>.</p>
															
								<hr />
								<h3>Comandos por teclado</h3>
								<div class="table-wrapper text-center">
									<table>
										<thead>
											<tr>
												<th>Tecla</th>
												<th>Operación</th>
												<th>Kernel (Núcleo)</th>
												<th>Imagen resultante</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td><img src="images/keyboard/0.png" style="width:40px;vertical-align: middle"/></td>
												<td>Identidad</td>
												<td><img src="images/matrix/matrix0.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs0.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
											<tr>
												<td><img src="images/keyboard/1.png" style="width:40px;vertical-align: middle"/></td>
												<td>Acentuar los bordes</td>
												<td><img src="images/matrix/matrix1.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs1.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
											<tr>
												<td><img src="images/keyboard/2.png" style="width:40px;vertical-align: middle"/></td>
												<td>Repujado</td>
												<td><img src="images/matrix/matrix2.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs2.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
											<tr>
												<td><img src="images/keyboard/3.png" style="width:40px;vertical-align: middle"/></td>
												<td>Detección de bordes</td>
												<td><img src="images/matrix/matrix3.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs3.png" style="width:130px;vertical-align: middle"/></td>
											</tr>											
											<tr>
												<td><img src="images/keyboard/4.png" style="width:40px;vertical-align: middle"/></td>
												<td>Detección de bordes</td>
												<td><img src="images/matrix/matrix4.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs4.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
											<tr>
												<td><img src="images/keyboard/5.png" style="width:40px;vertical-align: middle"/></td>
												<td>Detección de bordes</td>
												<td><img src="images/matrix/matrix5.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs5.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
											<tr>
												<td><img src="images/keyboard/6.png" style="width:40px;vertical-align: middle"/></td>
												<td>Enfocar</td>
												<td><img src="images/matrix/matrix6.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs6.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
											<tr>
												<td><img src="images/keyboard/7.png" style="width:40px;vertical-align: middle"/></td>
												<td>Desenfoque de cuadro<h5>(normalizado)</h5></td>
												<td><img src="images/matrix/matrix7.png" style="width:150px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs7.png" style="width:130px;vertical-align: middle"/></td>
											</tr>																					
											<tr>
												<td><img src="images/keyboard/8.png" style="width:40px;vertical-align: middle"/></td>
												<td>Operador de Robinson</td>
												<td><img src="images/matrix/matrix14.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs8.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
											<tr>
												<td><img src="images/keyboard/9.png" style="width:40px;vertical-align: middle"/></td>
												<td>Operador de Kirsch</td>
												<td><img src="images/matrix/matrix15.png" style="width:100px;vertical-align: middle"/></td>
												<td><img src="images/matrix/imgs9.png" style="width:130px;vertical-align: middle"/></td>
											</tr>
										</tbody>
									</table>
								</div>
								<div class="canvasp5js" >
									<div>
									<p align="center">
									<!-- HTML slider-->
									<iframe src="p5/js/shaders/convolution/index.html" style="position:relative;height:420px;width:920px"></iframe>
									</p>
																										
									</div>
									<blockquote>Image of Alligator a crocodilian in the genus Alligator of the family Alligatoridae. Source: Wikipedia, the free encyclopedia.<p><strong>Two American Alligators (Alligator mississippiensis), Florida, USA</strong></p>
										<hr />
										Video Clip of a live Alligator's eye. Source: RawShorts.<p><strong>Close-up of a live alligator's eye. Crocodile, caiman. Dinosaur monster stock video</strong></p>									
									</blockquote>
									
								</div>
								<p></p>
								<h4>p5*js Code</h4>
									<pre><code class="prettyprint">let theShader;
let shaderTexture;
let img;

let theShaderVideo;
let shaderVideo;
let video;

let angle=0;
let mask = 0;

function preload(){
	img = loadImage('https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Two_american_alligators.jpg/640px-Two_american_alligators.jpg');
	video = createVideo('https://dm0qx8t0i9gc9.cloudfront.net/previews/video/YSvEcxy/videoblocks-alligators-eye-close-up-of-a-live-alligators-eye-crocodile-caiman-dinosaur-monster_rmlq8ertq__cb8b5c0c7799d4c97439ed0d1d639f09__P360.mp4');
	video.hide();
	// Cargar los shaders
	theShader = loadShader('texture.vert','texture.frag');
	theShaderVideo = loadShader('texture.vert','texture.frag');  
}

function setup() {
	pixelDensity(1);
	
	// Se requiere trabajar con WEBGL
	createCanvas(windowWidth, 400, WEBGL);
	noStroke();

	// Inicializar la capa del createGraphics
	shaderTexture = createGraphics(512, 512, WEBGL);
	shaderVideo = createGraphics(windowWidth, windowHeight, WEBGL);
	
	// Quitar bordes en el createGraphics
	shaderTexture.noStroke();
	shaderVideo.noStroke();  
	
	video.loop();
}

function draw() {
	// Se pasa el shader a la capa del createGraphics
	shaderTexture.shader(theShader);
	shaderVideo.shader(theShaderVideo);

	// Valores uniform para el fragment shader
	theShader.setUniform("u_img", img);
	theShader.setUniform("u_key", mask);
	theShader.setUniform("u_stepSize", [1.0/width,1.0/height]);
	theShaderVideo.setUniform('u_img', video);
	theShaderVideo.setUniform('u_key', mask);
	theShaderVideo.setUniform("u_stepSize", [1.0/width,1.0/height]);
	
	// Renderizar el shader
	shaderTexture.rect(0,0,width,height);
	shaderVideo.rect(0,0,width,height);

	background(255);

	// Puntos de luz 
	pointLight(255, 255, 255, 0, 0, 500);
	// Efecto linterna
	let dx= mouseX-width/2;
	let dy= mouseY-height/2;
	pointLight(100,255,100,dx,dy,100);

	translate(0, 0, 0);
	push();
	// Se pasa el shader como textura
	texture(shaderTexture);
	translate(200, 0, 0);
	rotateZ(angle);
	rotateX(angle);
	rotateY(angle*2); 
	box(200);
	pop();
	
	// Rotacion de la caja
	angle += 0.002;
	
	push();
	// Se pasa la imagen original como textura
	texture(img);
	// Numero de puntas de la figura
	let ellipseFidelity = int(map(mouseX, 25, width, 8, 100));
	ellipse(-250, 0, 350, 350, ellipseFidelity);
	//plane(500,500);
	pop();
	
	push();
	//Se pasa el shader del video como textura
	texture(shaderVideo);
	translate(0, 0, -100);
	plane(900,500);
	pop();  
}

// Se ejecuta cuando se presiona cualquier tecla
function keyPressed() {
	if (key === '0') {
	mask = 0;
	} else if (key === '1') { 
	mask = 1;
	} else if (key === '2') {
	mask = 2;
	} else if (key === '3') {
	mask = 3;
	} else if (key === '4') {
	mask = 4;
	} else if (key === '5') {
	mask = 5;
	} else if (key === '6') {
	mask = 6;
	} else if (key === '7') {
	mask = 7;
	} else if (key === '8') {
	mask = 8;
	} else if (key === '9') {
	mask = 9;
	}
}</code></pre>

<h4>Vertex Code</h4>
									<pre><code class="prettyprint">attribute vec3 aPosition;
attribute vec2 aTexCoord;

// Obtener texcoords
varying vec2 vTexCoord;

void main() {

	// Copia los texcoords
	vTexCoord = aTexCoord;
	// Copia la poscicion de los datos en vec4, usando 1.0 como el componente w
	vec4 positionVec4 = vec4(aPosition, 1.0);

	// Escala la posicion por dos y la mueve al centro de la pantalla
	positionVec4.xy = positionVec4.xy * 2.0 - 1.0;

	// Envia la informacion del vertex al fragment shader
	gl_Position = positionVec4;
}</code></pre>

<h4>Fragment Code</h4>
									<pre><code class="prettyprint">attribute vec3 aPosition;
attribute vec2 aTexCoord;

// Obtener texcoords
varying vec2 vTexCoord;

void main() {

	// Copia los texcoords
	vTexCoord = aTexCoord;
	// Copia la poscicion de los datos en vec4, usando 1.0 como el componente w
	vec4 positionVec4 = vec4(aPosition, 1.0);

	// Escala la posicion por dos y la mueve al centro de la pantalla
	positionVec4.xy = positionVec4.xy * 2.0 - 1.0;

	// Envia la informacion del vertex al fragment shader
	gl_Position = positionVec4;
}</code></pre>
								
								<p></p>
								
								<!-- Pagination -->
							<ul class="actions pagination">
								<li><a href="pShaders1.html" target="_parent" class="button large previous">Previous Page</a></li>
								<li><a href="pShaders3.html" target="_parent" class="disabled button large next">Next Page</a></li>
							</ul>
							
							<!-- Footer 
								<footer>
									<ul class="stats">
										<li><a href="#">General</a></li>
										<li><a href="#" class="icon solid fa-heart">28</a></li>
										<li><a href="#" class="icon solid fa-comment">128</a></li>
									</ul>
								</footer>-->
								
							</article>

					</div>

				<!-- Footer -->
					<section id="footer">
					<!-- Se crea un iframe para insertar el html donde esta el pie de pagina-->
						<footer>
							<iframe id="iframepie" src="footer.html"></iframe>
						</footer>
						
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			
		<!-- Ejemplos P5.js 
			<script src="p5/js/pixels/pixelsImg.js"></script>-->

			
		<!-- Optional JavaScript -->
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
			<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
			<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
			<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

	</body>
</html>